<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Use correct character set. -->
    <meta charset="utf-8">
    <!-- Tell IE to use the latest, best version. -->
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- Make the application on mobile take up the full browser screen and disable user scaling. -->
    <meta name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
    <title>Hello World!</title>
    <script src="cesium/Cesium.js"></script>
    <script src="cesium/Sandcastle-header.js"></script>
    <script src="cesium/jquery-2.1.4.min.js"></script>
    <script src="cesium/jquery-form.js"></script>
    <script src="cesium/xlsx.core.min.js"></script>


    <script src='./functions/kinetic.js '></script>
    <script src='./functions/czml.js '></script>
    <script src='./functions/onkey.js '></script>
    <style>
        @import url(cesium/bucket.css);

        body {
            color: #000;
        }

        #toolbar {
            background: rgba(42, 42, 42, 0.8);
            padding: 4px;
            border-radius: 4px;
        }

        #toolbar_measure {
            background: rgba(42, 42, 42, 0.8);
            padding: 4px;
            border-radius: 4px;
            z-index: 99999;
        }

        button {
            color: #fff;
            background-color: #666666;
            text-align: center;
            border: 1px solid #1E90FF;
            border-radius: 4px;
        }

        .toolbar_measure button {
            width: 50px;
            height: 24px;
            border-radius: 0px;
            opacity: 0.8;
            border: 1px solid rgba(255, 255, 255, 1);
            color: #fff;
            background-color: rgba(0, 0, 0, 0.8);
            margin-left: 4px;
        }

        .toolbar_measure {
            position: absolute;
            top: 50px;
            right: 00px;
            z-index: 8888;
            display: none;
            width: 300px;
            height: 50px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 2px 0px 2px 2px;
            border: 1px solid rgba(204, 212, 222, 1);
        }

        /* //坐标样式 */

        .leftMenu {
            width: 160px;
            height: 80px;
            background-color: #f1f1f1;
            position: absolute;
            display: none;
            left: 300px;
            top: 300px;
            border-radius: 5px;
            z-index: 9999;
            line-height: 26px;
            padding-left: 5px;
        }

        .leftMenu p {
            margin: 0;
            padding: 0;
        }

        .Smodel {
            position: absolute;
            top: 40px;
            right: 226px;
            z-index: 20330;
            width: 176px;
            height: 300px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 2px;
            border: 1px solid rgba(204, 212, 222, 1);
            display: none;
            font-size: 12px;
        }

        .Smodel .model_content p {
            margin: 10px 7px;
            font-size: 12px;
        }

        .Smodel .model_content span {
            color: #fff;
        }

        .Smodel .model_content input {
            width: 105px;
            height: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 2px;
            border: 1px solid rgba(204, 212, 222, 1);
            color: #fff;
            padding-left: 5px;
            font-size: 12px;
        }

        .Smodel .model_content select {
            width: 105px;
            height: 20px;
            background: rgba(0, 0, 0, 0.5);
            border-radius: 2px;
            border: 1px solid rgba(204, 212, 222, 1);
            color: #fff;
            padding-left: 5px;
            font-size: 12px;
        }

        .Smodel .modelselect_p select {
            width: 80px !important;
        }

        .Smodel .model_content button {
            width: 40px;
            height: 20px;
            background: rgba(0, 0, 0, 1);
            border-radius: 2px;
            border: 1px solid rgba(255, 255, 255, 1);
            margin-left: 10px;
            color: #fff;
            font-size: 10px;
        }

        .Smodel .model_content button:hover {
            background: rgba(204, 212, 222, 0.5);
        }
    </style>
</head>
<body>

<div id="cesiumContainer" class="fullSize"></div>
<div class="leftMenu" id="modelInfo">
    <p></p>
</div>
<div id="toolbar" style="display:block;">
    <div align="center">
        按 F9 隐 藏 菜 单
    </div>
    <div>
        <div style="float:left;width:100%;">
            <div id="CreateCase" style="float: left">
            </div>
            <div style="float: left">
                <input type="file" id="case_file" style="display:none">
                <form id="kinetic_files" method="post" enctype="multipart/form-data" style="display:none"
                      action="/uploads" target="nm_iframe">
                    <input type="file" id="files" onchange="formSubmit()" name="upload" webkitdirectory mozdirectory>
                    <input type="submit" id="upload_confirm" value="确认上传文件夹">
                </form>

                <form action="/upload" , enctype="multipart/form-data" method="post" style="display:none">
                    <input type="file" name="upload" multiple="multipart">
                    <input type="submit" value="确认上传文件">
                </form>
                <iframe id="id_iframe" name="nm_iframe" style="display:none;"></iframe>
                <!--<input type="file" id="kinetic_file" webkitdirectory directory style="display:none" onchange="get_kinetic_file(this.value)">-->
                <table>
                    <tr>
                        <td>案 件 id：</td>
                        <td><select id="case_id" style="width:120px;height:25px" onchange="get_scenes(this.value)">
                            <option value="volvo" hidden>请选择案件</option>
                        </select></td>
                    </tr>
                </table>
            </div>
        </div>
        <div style="width:100%">
            <div id="CreateScene" style="float: left">
            </div>
            <div style="float: left">
                <table>
                    <tr>
                        <td>场 景 id：</td>
                        <td><select id="scene_id" style="width:120px;height:25px"
                                    onchange="select_scene(this.value)">
                            <option value="" hidden>请选择场景</option>
                        </select></td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    <div id="operations" style="float: left;display:none">
        <div id="caseMenu"></div>
        <div id="MeasureMenu"></div>
        <div id="modelMenu"></div>
        <div id="DynRoute"></div>
        <div>
            <div>
                <div id="KineticMenu" style="float: left;"></div>
                <div style="float: left;">
                    <table>
                        <tr>
                            <td><select id="kinetic_model" style="width:100px;height:25px">
                                <option value="volvo" hidden>选择动力学模型</option>
                            </select></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        <div>
            <div>
                <div id="ModelMeasure" style="float: left;"></div>
                <div style="float: left;">
                    <table>
                        <tr>
                            <td><select id="models" style="width:100px;height:25px" onchange="locate_model(this.value)">
                                <option value="volvo" hidden>要素与场信息</option>
                            </select></td>
                        </tr>
                    </table>
                </div>
            </div>
        </div>
        <div>
            <div>
                <table>
                    <tr>
                        <td>
                            <select id="top_icon_menu" style="width:100px;height:25px"
                                    onchange="get_sub_menu(this.value)">
                                <option value="volvo" hidden>选择图标大类</option>
                                <option value="办公类">办公类</option>
                                <option value="电子类">电子类</option>
                                <option value="交通类">交通类</option>
                                <option value="器具类">器具类</option>
                                <option value="生活类">生活类</option>
                                <option value="植物类">植物类</option>
                                <option value="主体类">主体类</option>
                                <option value="装饰类">装饰类</option>
                            </select>
                        </td>
                        <td><select id="sub_icon_menu" style="width:100px;height:25px"
                                    onchange="get_icon_menu(this.value)">
                            <option value="volvo" hidden>选择图标子类</option>
                        </select></td>

                        <td><select id="icon_menu" style="width:100px;height:25px"
                                    onchange="get_icon_image(this.value)">
                            <option value="volvo" hidden>选择图标图片</option>
                        </select></td>
                    </tr>

                </table>
            </div>
        </div>
        <div>
            <div style="float: left">
                <div id="markMenu" style="float: left"></div>
                <div style="float: left">
                    <input id="element_file" type="file" style="display:none" accept=".xls,.xlsx"
                           onchange="importFile(this)">
                    <table>
                        <tr>
                            <td><select id="element_type" style="width:80px;height:25px"
                                        onchange="get_element_menu(this.value)">
                                <option value="volvo" hidden>要素类别</option>
                                <option value="scene_handprint">手印痕迹</option>
                                <option value="scene_footprint">足迹痕迹</option>
                                <option value="scene_toolmark">工具痕迹</option>
                                <option value="scene_bio_evidence">生物物证</option>
                                <option value="scene_file_evidence">文检物证</option>
                                <option value="scene_elec_evidence">电子物证</option>
                            </select></td>
                            <td><select id="elements" style="width:80px;height:25px">
                                <option value="volvo" hidden>绑定要素</option>
                            </select></td>
                        </tr>

                    </table>
                </div>
            </div>
        </div>
        <div>
            <div style="float: left">
                <div id="infoMenu" style="float: left"></div>
                <div style="float: left">
                    <input id="info_file" type="file" style="display:none" accept=".xls,.xlsx"
                           onchange="importFile(this)">
                    <table>
                        <tr>
                            <td><select id="info_type" style="width:80px;height:25px"
                                        onchange="get_element_menu(this.value)">
                                <option value="volvo" hidden>信息类别</option>
                                <option value="scene_handprint">手印痕迹</option>
                                <option value="scene_footprint">足迹痕迹</option>
                                <option value="scene_toolmark">工具痕迹</option>
                                <option value="scene_bio_evidence">生物物证</option>
                                <option value="scene_file_evidence">文检物证</option>
                                <option value="scene_elec_evidence">电子物证</option>
                            </select></td>
                            <td><select id="infos" style="width:80px;height:25px">
                                <option value="volvo" hidden>绑定要素</option>
                            </select></td>
                        </tr>

                    </table>
                </div>
            </div>
            <div>
                <div style="float: left">
                    <div id="thingMenu" style="float: left"></div>
                    <div style="float: left">
                        <input id="thing_file" type="file" style="display:none" accept=".xls,.xlsx"
                               onchange="importFile(this)">
                        <table>
                            <tr>
                                <td><select id="thing_type" style="width:80px;height:25px"
                                            onchange="get_element_menu(this.value)">
                                    <option value="volvo" hidden>物品类别</option>
                                    <option value="scene_handprint">手印痕迹</option>
                                    <option value="scene_footprint">足迹痕迹</option>
                                    <option value="scene_toolmark">工具痕迹</option>
                                    <option value="scene_bio_evidence">生物物证</option>
                                    <option value="scene_file_evidence">文检物证</option>
                                    <option value="scene_elec_evidence">电子物证</option>
                                </select></td>
                                <td><select id="things" style="width:80px;height:25px">
                                    <option value="volvo" hidden>绑定要素</option>
                                </select></td>
                            </tr>

                        </table>
                    </div>
                </div>
            </div>
            <div>
                <div style="float: left">
                    <div id="humanMenu" style="float: left"></div>
                    <div style="float: left">
                        <input id="human_file" type="file" style="display:none" accept=".xls,.xlsx"
                               onchange="importFile(this)">
                        <table>
                            <tr>
                                <td><select id="human_type" style="width:80px;height:25px"
                                            onchange="get_element_menu(this.value)">
                                    <option value="volvo" hidden>涉案人类别</option>
                                    <option value="scene_handprint">手印痕迹</option>
                                    <option value="scene_footprint">足迹痕迹</option>
                                    <option value="scene_toolmark">工具痕迹</option>
                                    <option value="scene_bio_evidence">生物物证</option>
                                    <option value="scene_file_evidence">文检物证</option>
                                    <option value="scene_elec_evidence">电子物证</option>
                                </select></td>
                                <td><select id="humen" style="width:80px;height:25px">
                                    <option value="volvo" hidden>绑定要素</option>
                                </select></td>
                            </tr>

                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="toolbar_measure">
        <button type="button" onclick="pick()">坐标</button>

        <button type="button" onclick="heightMeasuring()">高度</button>
        <button type="button" onclick="distanceDraw()">距离</button>
        <button type="button" onclick="areaMeasuring()">面积</button>
        <button type="button" onclick="stopMeasure()">退出</button>
    </div>

    <div class="Smodel">
        <div class="model_content">
            <p><span>名称：</span><input type="text" class="Sname" placeholder="请输入名称"></p>
            <p><span>经度：</span><input type="number" class="Slongitude" placeholder="请输入经度" step="0.00001"></p>
            <p><span>纬度：</span><input type="number" class="Slatitude" placeholder="请输入纬度" step="0.00001"></p>
            <p><span>高度：</span><input type="number" class="Sheight" placeholder="请输入高度" step="0.1"></p>
            <p><span>方向：</span><input type="number" class="Sdirection" placeholder="请输入方向" value="0"></p>
            <p><span>比例：</span><input type="number" class="Sproportion" placeholder="请输入比例" value="1" min="0.1"
                                      step="0.1">
            </p>
            <p><span>预案：</span><select class="planOption">
                <option value="1">预案一</option>
                <option value="2">预案二</option>
                <option value="3">预案三</option>
            </select></p>
            <p class="modelselect_p"><span>选择模型：</span><select class="dropdownMenu">
                <option value="./img/modelImg/gou.glb">警犬</option>
                <option value="./img/modelImg/yisheng.glb">医生</option>
                <option value="./img/modelImg/wujing.glb">武警</option>
                <option value="./img/modelImg/xiaofangyuan.glb">消防员</option>
                <option value="./img/modelImg/jingchanan.glb">警察男</option>
                <option value="./img/modelImg/jingchanv.glb">警察女</option>
                <option value="./img/modelImg/fangbaoche.glb">防暴车</option>
                <option value="./img/modelImg/jingche.glb">警车</option>
                <option value="./img/modelImg/motuoche.glb">摩托车</option>
                <option value="./img/modelImg/zhihuiche.glb">指挥车</option>
                <option value="./img/modelImg/gongjiaoche.glb">公交车</option>
                <option value="./img/modelImg/jijuche.glb">救护车</option>
                <option value="./img/modelImg/jiuyuanche.glb">救援车</option>
                <option value="./img/modelImg/xiaofangche.glb">消防车</option>
                <option value="./img/modelImg/jingyonggongjiaoche.glb">警用公交车</option>
                <option value="./img/modelImg/luzhang.glb">路障</option>
                <option value="./img/modelImg/miehuoche.glb">灭火器</option>
                <option value="./img/modelImg/zucheding.glb">阻车钉</option>
            </select></p>
            <button type="button" class="StakeBtn" onclick="siteModelTake('.Slongitude','.Slatitude','.Sheight')">量取
            </button>
            <button type="button" class="Ssubmit" onclick="addModelInfo()">提交</button>
            <button type="button" class="Sdropout" onclick="stopModel()">退出</button>

        </div>
    </div>
    <div id="menu">
        <button id="show_model_info" type="button" style="width:125px;" onclick="show_model_info()">显示详情</button>
        <button type="button" style="width:125px;">删除标定</button>
        <button type="button" style="width:125px;">更改位置</button>
    </div>
    <div id="start_kinetic_model" style="display: none">
        <button id="start_fire_model" onclick="start_fire()"></button>
        <input id="fire_type_name" value="smoke">
        <button id="start_collision_model" onclick="start_collision()"></button>
        <button id="start_explosion_model" onclick="start_explosion()"></button>
        <button id="start_kill_model" onclick="start_kill()"></button>
    </div>

    <style>
        #menu {
            width: 0; /*设置为0 隐藏自定义菜单*/
            overflow: hidden; /*隐藏溢出的元素*/
            box-shadow: 0 1px 1px #888, 1px 0 1px #ccc;
            position: absolute; /*自定义菜单相对与body元素进行定位*/
        }
    </style>

    <script>


        //关闭右键菜单，很简单
        window.onclick = function (e) {

//用户触发click事件就可以关闭了，因为绑定在window上，按事件冒泡处理，不会影响菜单的功能
            document.querySelector('#menu').style.height = 0;
        }

        //导入要素表格文件
        function importFile(obj) {//导入
            console.log("已选择文件");
            if (!obj.files) {
                alert("文件有误");
                return;
            }
            // alert(obj.files[0].name);文件名
            var f = obj.files[0];
            var reader = new FileReader();

            reader.onload = function (e) {
                var data = e.target.result;
                var wb = XLSX.read(data, {
                    type: 'binary' //以二进制的方式读取
                });
                var sheet0 = wb.Sheets[wb.SheetNames[0]];//sheet0代表excel表格中的第一页
                var str = XLSX.utils.sheet_to_json(sheet0);//利用接口实现转换。
                var templates = new Array();
                var str1 = obj.files[0].name;
                templates = str1.split(".");//将导入文件名去掉后缀
                var form = JSON.stringify(str);
                console.log("这" + form);
                $.get("/store_elements", {"form": form, "scene_id": $("#scene_id").val()}, function (data) {
                    alert(data.msg);
                })
            }
            reader.readAsBinaryString(f);
        }

        $(document).ready(function () {
            var options = {
                target: '#output2',   // target element(s) to be updated with server response
                beforeSubmit:
                    function (data) {
                        console.log("提交前函数");
                    },
                success:
                    function showResponse(responseText, statusText, xhr, $form) {
                        console.log(responseText);
                        alert(responseText.msg);
                        var gltfs = responseText.model_info;
                        for (var i = 0; i < gltfs.length; i += 2) {
                            $("#models").append('<option value=' + gltfs[i + 1] + ' >' + gltfs[i] + '</option>');
                        }
                        var kin = responseText.kinetic_id;

                        $("#kinetic_model").append('<option value=' + kin + ' >' + kin + '</option>');
                        $("#kinetic_model").val(kin);
                        // if(responseText.status == "0"){
                        //     console.log("上传成功");
                        //     /**
                        //      * 请求成功后的操作
                        //      */
                        //     alert(responseText);
                        // } else {
                        //     alert('上传失败');
                        // }
                    },
                // other available options:
                //url:       url         // override for form's 'action' attribute
                //type:      type        // 'get' or 'post', override for form's 'method' attribute
                dataType: 'json'        // 'xml', 'script', or 'json' (expected server response type)
                //clearForm: true        // clear all form fields after successful submit
                //resetForm: true        // reset the form after successful submit

                // $.ajax options can be used here too, for example:
                //timeout:   3000
            };

            $('#kinetic_files').submit(function () {
                $(this).ajaxSubmit(options);
                return false;
            });
        });

        function formSubmit() {
            document.getElementById("upload_confirm").click();
        }

        $(function () {
            $("#files").on("change", function (e) {
                $.each(this.files, function (k, v) {
                    console.log(v.type + "=" + v.webkitRelativePath);
                });
            });
        })

        function select_case() {
            $("#case_file").trigger("click");
        }


        var viewer = new Cesium.Viewer('cesiumContainer', {
            shouldAnimate: false,
            baseLayerPicker: false,
            homeButton: false,       //是否显示home键
            timeline: true,        //是否显示时间线控件
            fullscreenButton: false, //是否全屏显示
            scene3DOnly: true,     //如果设置为true，则所有几何图形以3D模式绘制以节约GPU资源
            infoBox: true,         //是否显示点击要素之后显示的信息
            sceneModePicker: false,  //是否显示投影方式控件  三维/二维
            navigationInstructionsInitiallyVisible: false,
            navigationHelpButton: false,     //是否显示帮助信息控件
            selectionIndicator: false,        //是否显示指示器组件
            imageryProvider: new Cesium.ArcGisMapServerImageryProvider({
                url: 'https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer'
            }),
            // imageryProvider: new Cesium.createTileMapServiceImageryProvider({
            //     url: 'cesium/googleTMS',
            // }),
            // terrainProvider: Cesium.createWorldTerrain()//加载地势
        });
        viewer._cesiumWidget._creditContainer.style.display = "none";  //	去除版权信息
        viewer.scene.globe.depthTestAgainstTerrain = false;
        viewer.camera.setView({
            destination: Cesium.Cartesian3.fromDegrees(105.07224017290507, 36.56475804850547, 4889916.564370803),
            orientation: {
                heading: 0.0,
                pitch: Cesium.Math.toRadians(-90.0),
                roll: 0.0
            }
        });
        var scene = viewer.scene;
        var clock = viewer.clock;



        function middlePoint(x1, y1, x2, y2, per) {
            var mx = x1 + (x2 - x1) * per;
            var my = y1 + (y2 - y1) * per;
            console.log("起点：" + x1 + "," + y1 + "   " + "终点：" + x2 + "," + y2 + "  per：" + per + "中点：" + mx + "," + my);
        }


        var entity = viewer.entities.add({
            id: 'GroundVehicle',
            position: Cesium.Cartesian3.fromDegrees(-123.0744619, 44.0503706, 0),
            model: {
                uri: 'cesium/Models/CesiumMilkTruck/CesiumMilkTruck.glb',
                heightReference: Cesium.HeightReference.CLAMP_TO_GROUND
            },
            scale: 1.0,
            minimumPixelSize: 100,
            show: true,
            colorBlendMode: Cesium.ColorBlendMode.MIX
        });
        // viewer.trackedEntity = entity;
        var entity1 = viewer.entities.add({
            id: 'ferrari',
            position: Cesium.Cartesian3.fromDegrees(-123.0744619, 44.0503706, 0),
            model: {
                uri: 'cesium/Models/mesh_final.gltf',
                heightReference: Cesium.HeightReference.CLAMP_TO_GROUND
            },
            scale: 1.0,
            minimumPixelSize: 100,
            show: false
        });

        // viewer.trackedEntity=entity1;

        //设置鼠标右键点击事件
        window.oncontextmenu = function (e) {
            e.preventDefault();
        }
        window.onclick = function (e) {
            document.querySelector('#menu').style.width = 0;
        }
        // Sandcastle.addToolbarButton('砍杀模型', function () {
        //
        // }, 'modelMenu');

        //菜单案件与场景选项逻辑
        $.get("/get_cases", {"value": "get_cases"}, function (data) {
            cases = data;
            cases.forEach(function (json) {
                $("#case_id").append('<option value=' + json.case_id + ' >' + json.case_id + '</option>');
            });
        })

        var json = {
            "scene_bio_evidence": "bio",
            "scene_elec_evidence": "elec",
            "scene_file_evidence": "file",
            "scene_footprint": "foot",
            "scene_handprint": "hand",
            "scene_tool": "tool"
        }

        function show_model_info() {
            var json = {
                "scene_bio_evidence": "bio",
                "scene_elec_evidence": "elec",
                "scene_file_evidence": "file",
                "scene_footprint": "foot",
                "scene_handprint": "hand",
                "scene_toolmark": "tool"
            }
            window
                .open(
                    "http://127.0.0.1:3000/web/index?type=" + json[$("#element_type").val()] + "&id=" + $("#elements").val(),
                    "show_element_info",
                    "height=700, width=1000, top=200, left=300,toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no");
        }

        function locate_model(path) {
            alert("点击鼠标左键选定模型位置，右键单击退出模型定位模式");
            operation_type = "locate_model";
        }

        function get_scenes(case_id) {
            console.log("案件id为：" + case_id);
            $.get("/get_scenes", {"value": case_id}, function (data) {
                scenes = data;
                $("#scene_id").find("option").remove();
                $("#scene_id").append("<option value='volvo' hidden>请选择场景</option>");
                scenes.forEach(function (json) {
                    $("#scene_id").append('<option value=' + json.scene_id + ' >' + json.scene_id + '</option>');
                });
            })
        }

        function get_element_menu(element_type) {
            console.log("要素大类为：" + element_type);
            $("#elements").find("option").remove();
            $("#elements").append("<option value='volvo' hidden>绑定要素</option>");
            $.get("/get_elements", {
                "element_type": $("#element_type").val(),
                "scene_id": $("#scene_id").val()
            }, function (data) {
                if (data.msg != undefined) {
                    alert(data.msg);
                    return;
                }
                data.forEach(function (json) {
                    $("#elements").append('<option value=' + json.ID + ' > 序号' + json.ID + '</option>');
                });
            })
        }

        function get_sub_menu(top_name) {
            console.log("图标大类名为：" + top_name);
            $("#sub_icon_menu").find("option").remove();
            $("#sub_icon_menu").append("<option value='volvo' hidden>选择图标子类</option>");
            $("#icon_menu").find("option").remove();
            $("#icon_menu").append("<option value='volvo' hidden>选择图标图片</option>");
            $.get("/get_sub_menu", {"value": top_name}, function (data) {
                sub_menu = data;
                sub_menu.forEach(function (sub_name) {
                    $("#sub_icon_menu").append('<option value=' + sub_name + ' >' + sub_name + '</option>');
                });
            })
        }

        function get_icon_menu(sub_name) {
            $("#icon_menu").find("option").remove();
            $("#icon_menu").append("<option value='volvo' hidden>选择图标图片</option>");
            var top_name = document.getElementById("top_icon_menu").value;
            $.get("/get_icon_menu", {"top_name": top_name, "sub_name": sub_name}, function (data) {
                icon_menu = data;
                icon_menu.forEach(function (icon_name) {
                    $("#icon_menu").append('<option value=' + icon_name + ' >' + icon_name + '</option>');
                });
            })
        }

        function get_icon_image(icon_name) {
            var top_name = document.getElementById("top_icon_menu").value;
            var sub_name = document.getElementById("sub_icon_menu").value;
            element_image = "cesium/icons/" + top_name + "/" + sub_name + "/" + icon_name;
        }

        function select_scene(scene_id) {
            document.getElementById("operations").style.display = "";
            $.get("/select_scene", {"value": scene_id}, function (data) {
                console.log("选择场景号：" + scene_id);
                for (var i = 0; i < data.kinetic_info.length; i++) {
                    $("#kinetic_model").append('<option value=' + data.kinetic_info[i].id + ' >' + data.kinetic_info[i].kinetic_id + '</option>');
                }
                console.log(data);
                var relevant_info = data.relevant_info;
                for (var i = 0; i < relevant_info.length; i++) {
                    var longitude = relevant_info[i].start_lon;
                    var latitude = relevant_info[i].start_lat;
                    var height = relevant_info[i].start_height
                    var icon_path = relevant_info[i].icon_path;
                    var id = relevant_info[i].id;
                    var element_type = relevant_info[i].element_type;
                    var element_id = relevant_info[i].element_id;
                    viewer.entities.add({
                        position: Cesium.Cartesian3.fromDegrees(longitude, latitude, height),
                        billboard: {
                            image: icon_path,
                            // heightReference: Cesium.HeightReference.RELATIVE_TO_GROUND,
                            // heightReference: Cesium.HeightReference.CLAMP_TO_GROUND,
                            scale: 0.2,
                            verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                            horizontalOrigin: Cesium.HorizontalOrigin.LEFT,
                            disableDepthTestDistance: Number.POSITIVE_INFINITY
                        },
                        properties: {
                            type: "added",
                            element_id: element_id,
                            element_type, element_type
                        }
                    });

                }
                if (data.location[0].lon != null && data.location[0].lon != undefined) {
                    set_view(data.location[0].lon, data.location[0].lat);
                }
                // data.forEach(function (icon_name) {
                //     console.log(icon_name);
                //     $("#icon_menu").append('<option value=' + icon_name + ' >' + icon_name + '</option>');
                // });

            })
        }

        function set_view(lon, lat) {
            viewer.camera.setView({
                destination: Cesium.Cartesian3.fromDegrees(lon, lat, 800),
                orientation: {
                    heading: 0.0,
                    pitch: Cesium.Math.toRadians(-90.0),
                    roll: 0.0
                }
            });
        }



    </script>
    <script src='./js/measuring.js'></script>
    <script src='./js/blast.js'></script>
    <script src='./js/collision.js '></script>
    <script src='./js/modelMark.js'></script>
    <script src='./js/plug-in.js '></script>
    <script src='./functions/sandcastle.js '></script>
    <script src='./functions/handler.js '></script>
    <script src='./functions/fire.js '></script>
    <script src='./functions/collision.js '></script>
    <script src='./functions/explosion.js '></script>
    <script src='./functions/mix.js '></script>
    <script src='./functions/dynamicRoute.js '></script>
    <script src='./functions/tileset.js '></script>
</body>
</html>
